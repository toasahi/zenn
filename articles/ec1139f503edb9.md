---
title: "Sentry SourceMap Upload CI/CD"
emoji: "ğŸ“˜"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Sentry","GithubActions","CI","javascript"]
published: true
---
# Sentryã¨ã¯
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼ã®å¯è¦–åŒ–ã€ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã¾ã§è¤‡æ•°ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

https://sentry.io/welcome/?gad_source=1

#### ç”¨èªè§£èª¬
DSN : Sentry SDKã«ã‚¤ãƒ™ãƒ³ãƒˆã®é€ä¿¡å…ˆã‚’ä¼ãˆã€æ­£ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é–¢é€£ã¥ã‘ã‚‹

# ç’°å¢ƒæ§‹ç¯‰
ä»Šå›ã¯Reactã¨Viteã‚’ä½¿ã£ã¦ã€SourceMapã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ã—ã¦ã„ãã¾ã™ã€‚
### React
**1.Viteã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
```bash
npm create vite@latest
Need to install the following packages:
  create-vite@5.0.0
Ok to proceed? (y)
âœ” Project name: â€¦ sentry-test
âœ” Select a framework: â€º React
âœ” Select a variant: â€º TypeScript

Scaffolding project in /sentry-test...
```

**2.ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
cd sentry-test
npm install
```

## Sentry
**1.ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
Sentryã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€2é€±é–“ã¯ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ãƒ—ãƒ©ãƒ³ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://sentry.io/welcome/
**2.Sentryã®Projectä½œæˆ**
Sentryã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ãŸå¾Œã«CreateProjectã‹ã‚‰Projectã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/1cd8595249d3-20231209.png)
ä»Šå›ã¯Reactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/95cd83351fcd-20231209.png)

**3.Reactã®SDKã¨Sentryã®DSNã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ **
å…ˆã»ã©Viteã§ä½œæˆã—ãŸReactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«Sentryã®SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™
```bash
npm install --save @sentry/react
```

SentrySDKã®è¨­å®š
dsnéƒ¨åˆ†ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã¨ãã«ç™ºè¡Œã•ã‚Œã‚‹å€¤ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
```typescript:main.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css'
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "https://public@sentry.example.com/1",
  integrations: [],
});

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
```

**4.SourceMapã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
Reactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’gitã§ç®¡ç†ã™ã‚‹
```bash
  git init
  git add .
  git commit -m "first commit"
```

å¯¾è©±å½¢å¼ã§SourceMapã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ç’°å¢ƒã‚’ä½œæˆã§ãã¾ã™
```bash
npx @sentry/wizard@latest -i sourcemaps

â”Œ   Sentry Source Maps Upload Configuration Wizard
â”‚
â—‡  Are you using Sentry SaaS or self-hosted Sentry?
â”‚  Sentry SaaS (sentry.io)
â”‚
â—‡  Do you already have a Sentry account?
â”‚  Yes
â”‚
â—  If the browser window didn't open automatically, please open the following link to log into Sentry:
â”‚
â”‚  https://sentry.io/account/settings/wizard/****************************/
â”‚
â—‡  Login complete.
â”‚
â—‡  Select your Sentry project.
â”‚  sentry-test/react-zenn
â”‚
â—‡  Which framework, bundler or build tool are you using?
â”‚  Vite
â”‚
â—‡  Installed @sentry/vite-plugin with NPM.
â”‚
â—†  Added the Sentry Vite plugin to vite.config.ts and enabled source maps
â”‚
â—  We recommend checking the modified file after the wizard finished to ensure it works with your build setup.
â”‚
â—†  Created .env.sentry-build-plugin with auth token for you to test source map uploading locally.
â”‚
â—†  Added .env.sentry-build-plugin to .gitignore.
â”‚
â—‡  Are you using a CI/CD tool to build and deploy your application?
â”‚  Yes
â”‚
â—‡  Add the Sentry authentication token as an environment variable to your CI setup:

SENTRY_AUTH_TOKEN=**************************************

â”‚
â–²  DO NOT commit this auth token to your repository!
â”‚
â—‡  Did you configure CI as shown above?
â”‚  Yes, continue!
â”‚
â””  That's it - everything is set up!

ğŸ‰  Successfully set up Sentry for your project ğŸ‰
```
ğŸ‰ã“ã¡ã‚‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰Source Mapã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™ã¯ã§ãã¾ã—ãŸ
è©¦ã—ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã¿ã¦ãã ã•ã„!!
```bash
npm run build
```

# Github Actions ã§ Source Mapã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
**1.Githubã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ**
Githubã®ãƒªãƒã‚¸ãƒˆãƒªã«Reactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
```
  git branch -M main
  git remote add origin git@github.com:user/sentry-test.git
  git push -u origin main
```

**2.ğŸ”‘SENTRY_AUTH_TOKENã‚’è¿½åŠ **
**sentry-test > Settings > Secrets and variables > Actions > Repository secrets**
SENTRY_AUTH_TOKENãŒã‚ã‹ã‚‰ãªã„å ´åˆã¯Reactã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ã‚‹`.env.sentry-build-plugin`ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/038d17a0ff9b-20231209.png)

**3.Workflowã‚’æº–å‚™**
```yaml:.github/workflows
name: upload-souce-map-workload
run-name: ${{ github.actor }}
on: 
 push: 
   branches: 
    - main
jobs:
    source-map-upload:
        runs-on: ubuntu-latest #ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã‚µãƒ¼ãƒ
        timeout-minutes: 10
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: initialize
              run: npm install
            
            - name: soucemap
              run: npm run build
              env:
                SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
```


ã“ã¡ã‚‰ã®æ‰‹é †ã§Github Actionsã§Sentryã«Source Mapã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå¾Œã¯é–‹ç™ºã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã€æœ¬ç•ªã®ç’°å¢ƒã”ã¨ã«åˆ†ã‘ã‚Œã‚‹ã‚ˆã†ã«workflowã‚’æ”¹å–„ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™!!!